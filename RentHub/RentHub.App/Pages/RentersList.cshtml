@page
@model RentHub.App.Pages.RentersListModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Список жильцов</title>
    <link href="~/css/MainPage.css" rel="stylesheet" />
    <link href="~/css/RentersList.css" rel="stylesheet">
</head>
<body>

    <div id="side-bar">
        <p id="main-text">Недвижимость</p>

        <form class="menu-item" method="get" action="/MainFlats">
            <img src="~/img/side-bar/House 1.svg" alt="404" />
            <button type="submit" name="FlatsBtn">Квартиры</button>
        </form>

        <form class="menu-item" method="get" action="/Reservations">
            <img src="~/img/side-bar/Calendar 1.svg" alt="404" />
            <button type="submit" name="ReservationsBtn">Бронирования</button>
        </form>

        <form class="menu-item" method="get" action="/RentersList">
            <img src="~/img/side-bar/users 1.svg" alt="404" />
            <button type="submit" name="CustomersBtn">Жильцы</button>
        </form>

        <form class="menu-item" method="get" action="/Reportcshtml">
            <img src="~/img/side-bar/chart-no-axes-column 1.svg" alt="404" />
            <button type="submit" name="recordsBtn">Отчетность</button>
        </form>
    </div>

    <div id="main-content-main-page">
        <div class="top-bar">
            <form asp-page-handler="Logout" id="logoutForm">
                <a href="#" onclick="confirmLogout()">
                    <img src="~/img/userIcon.svg" alt="Фотка иконки юзера" />
                </a>
            </form>
            <a href="#"><img src="~/img/bell.svg" alt="Фотка иконки уведомлений" /></a>
        </div>

        <div class="search-container">
            <div class="search-bar-container">
                <input id="searchInput" type="text" placeholder="Поиск..." />
            </div>
        </div>

        <div class="renters-card-container" id="rentersContainer">
            @if (Model.Renters != null && Model.Renters.Any())
            {
                @foreach (var renter in Model.Renters)
                {
                    <div class="renter-card" data-search="@($"{renter.Patronymic} {renter.Name} {renter.Lastname} {renter.PhoneNumber}")">
                        <div class="renter-info-container">
                            <h3>@renter.Patronymic @renter.Name @renter.Lastname</h3>
                            <p><span>Телефон:</span> @renter.PhoneNumber</p>
                        </div>
                        <div class="delete-renter-container">
                            <form method="post" asp-page-handler="DeleteRenter" onsubmit="return confirm('Вы уверены, что хотите удалить этого жильца?');">
                                <input type="hidden" name="RenterIdToDelete" value="@renter.RenterId" />
                                <button type="submit" id="deleteButton">🗑</button>
                            </form>
                        </div>
                    </div>
                }
            }
        </div>

        <div id="noResults" class="no-renters" style="display: none;">
            <p>Жильцы не найдены</p>
        </div>

        <button id="addRenterBtn" class="add-button">+</button>
    </div>

    <div id="addRenterModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Добавить нового арендатора</h2>
            <form id="addRenterForm" method="post" asp-page-handler="AddRenter">
                <div class="form-group">
                    <input type="text" placeholder="Фамилия" asp-for="NewRenter.Lastname" id="lastname" name="lastname" required>
                </div>
                <div class="form-group">
                    <input type="text" placeholder="Имя" asp-for="NewRenter.Name" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <input type="text" placeholder="Отчество" asp-for="NewRenter.Patronymic" id="patronymic" name="patronymic">
                </div>
                <div class="form-group">
                    <input type="tel" placeholder="Номер телефона" asp-for="NewRenter.PhoneNumber" id="phoneNumber" name="phoneNumber" required>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="submit-btn">Добавить</button>
                    <button type="button" class="cancel-btn">Отмена</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function confirmLogout() {
            if (confirm('Вы уверены, что хотите выйти?')) {
                document.getElementById('logoutForm').submit();
            }
        }
        const modal = document.getElementById('addRenterModal');
        const addBtn = document.getElementById('addRenterBtn');
        const closeBtn = document.querySelector('.close');
        const cancelBtn = document.querySelector('.cancel-btn');
        const form = document.querySelector('#addRenterForm')

         addBtn.onclick = function () {
            modal.style.display = 'block';
         }

         closeBtn.onclick = function () {
            modal.style.display = 'none';
            form.reset();
         }

         cancelBtn.onclick = function () {
            modal.style.display = 'none';
            form.reset();
         }

         window.onclick = function (event) {
         if (event.target == modal) {
                modal.style.display = 'none';
                form.reset();
         }
        }

        document.getElementById('searchInput').addEventListener('input', function (e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            const cards = document.querySelectorAll('.renter-card');
            const noResults = document.getElementById('noResults');
            let hasVisible = false;

            cards.forEach(card => {
                const searchText = card.getAttribute('data-search').toLowerCase();
                if (searchText.includes(searchTerm)) {
                    card.style.display = 'block';
                    hasVisible = true;
                } else {
                    card.style.display = 'none';
                }
            });

            if (!hasVisible && searchTerm !== '') {
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
            }
        });
    </script>
</body>
</html>